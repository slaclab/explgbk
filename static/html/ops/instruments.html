<div class="container-fluid text-center tabcontainer" id="ops_instruments_tab">
<div class="row">
  <div class="panel panel-default">
   <div class="panel-body">
     <div class="row btnbar">
       <button class="btn btn-default panel_btn" id="new_instrument">New Instrument</button>
     </div>
     <div id="ins_mdl_holder"></div>
     <div class="table-responsive">
       <table class="table table-condensed table-striped table-bordered" id="instrumentstbl">
         <thead><tr><th>Name</th><th>Description</th><th>Number of Stations</th><th>Edit</th></tr></thead>
         <tbody></tbody>
       </table>
     </div>
  </div>
  </div>
</div>
</div>

<script type="text/javascript">
$("#ops_instruments_tab").on("lg.shown.bs.tab", function() {
  var instmpl = `{{#value}}<tr>
        <td class="instrument_lbl">{{ _id }}</td>
        <td>{{ description }}</td>
        <td>{{ params.num_stations}}</td>
        <td> <a class="editinsbtn" href="#"><span class="glyphicon glyphicon-edit"></span>&nbsp;</a> </td>
    </tr>{{/value}}`;
  Mustache.parse(instmpl);
  $.getJSON(instruments_url)
  .done(function(instruments){
    var rendered = $(Mustache.render(instmpl, instruments));
    rendered.find(".editinsbtn").on("click", function(){
      var insname = $(this).parents("tr").find("td").first().text();
      console.log("Editing instrument " + insname);
      $.ajax ("../static/html/ms/insedit.html")
      .done(function(tmpl){
        Mustache.parse(tmpl);
        var instr_obj = _.find(instruments.value, function(instr){ return instr._id == insname; });
        instr_obj.paramkvs = _.map(instr_obj['params'], function(value, key) { return { key: key, value: value };});
        $("#ins_mdl_holder").append($(Mustache.render(tmpl, instr_obj)));
        $("#ins_mdl_holder").find(".edit_modal").on("hidden.bs.modal", function(){ $(".modal-body").html(""); $("#ins_mdl_holder").empty(); });
        $("#ins_mdl_holder").find(".edit_modal").modal("show");
      });
    });
    $("#instrumentstbl tbody").append(rendered);
  });
});
