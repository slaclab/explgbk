<!doctype html>
<html lang="en">
<head>
  <title>Sorting/Pagination Widget</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" type="text/css" href="../../js/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="../../js/@fortawesome/fontawesome-free/css/all.min.css">

  <script type="text/javascript" src="../../js/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="../../js/mustache/mustache.min.js"></script>
  <script type="text/javascript" src="../../js/lodash/lodash.min.js"></script>
  <script type="text/javascript" src="../../js/moment/min/moment-with-locales.min.js"></script>
  <script type="text/javascript" src="../../js/bootstrap/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="../../js/@fortawesome/fontawesome-free/js/all.min.js"></script>
  <script type="text/javascript" src="../../static/spgntr.js"></script>

<style type="text/css">
body {
    width: 8.5in;
    height: 11in;
    padding: 1.0em;
}
</style>

</head>
<body>
<div class="container-fluid">

<h4>Sorting/Pagination Widget</h4>
<div>
A widget that supports sorting/pagination.
Constructor arguments
<ul>
    <li><b>container</b> A jQuery DOM object; typically the top level object.
        <ul><li>For example, if you are displaying data in a table, this would be the jQuery object for the table.</li></ul>
        The container object is expected to have one child with a <i>spgntr_append</i> class.
        DOM elements generated by an object's <i>render</i> method are appended to this child.
        <ul><li>For example, if you are displaying data in a table, this would be the table's tbody.</li></ul>
        Events are triggered on the container; state is stored in the container.
        The paginator is accessed using the container's <i>spgntr</i> data attribute.
        For example, if the table has a id of <code>sorted_table</code>, then <code>$("#sorted_table").data("spgntr")</code> is the paginator.
    </li>
    <li><b>key_attr</b> A key attrbute. All objects added to the paginator are expected to have this key attribute.
        The key is also used to identify the UI element for an object by using jQuery's attribute selectors.
        To support this, when rendering the UI element for an object, add an attribute called <b>data-spgntr</b> whose value is the key.
    </li>
    <li><b>sort_attr</b> A sort attrbute - This is passed to Lodash's sortBy, sortedIndexBy and findIndex methods.
    For best results, use a attribute name. It should be possible to use a sort function; however, this has not been tested yet.</li>
    <li><b>sort_desc</b> A boolean to indicate if you want a descending sort. Defaults to false.</li>
    <li><b>page_start, page_end, page_size</b> Page parameters; these default to 0, 2000 and 100.</li>
</ul>

Objects that get added to the widget must have
<ul>
    <li><b>render</b> A render function - This is called to generate the UI element for an object.
        The generated UI element must have a data attribute called <b>data-spgntr</b> whose value is the object's key.
    </li>
</ul>

The paginator supports these methods
<ul>
    <li><b>addObjects</b> Add an array of objects.
        For best results, use this when initializing the page.
        That is, use this method (as opposed to <i>addObject</i>) when the UI is empty <b>and</b> you want to add all your server-side objects into the UI in one stroke.
    </li>
    <li><b>addObject</b> Add/update a single object. If you are establishing websocket connections to the backend to pick up updates/inserts, this is the method to use.</li>
    <li><b>pageDown</b> Page down. Tie this to a <code>$(window).scroll</code>. For example,
        <code><pre>$(window).scroll(function () {
  if ($(window).scrollTop() >= $(document).height() - $(window).height() - 10) {
  $("#sorted_table").data("spgntr").pageDown();
}});</pre></code>
    </li>
</ul>

Events
<ul>
    <li><b>lgbk.empty_and_initialize</b> - Triggered when initializing and redrawing the whole UI widget.
        The paginator will empty the <i>spgntr_append</i> child before triggering this event.
    </li>
</ul>

</div>

<table id="sorted_table" class="table table-striped table-hover table-bordered">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">First</th>
      <th scope="col">Last</th>
    </tr>
  </thead>
  <tbody class="spgntr_append">
  </tbody>
</table>


<script type="text/javascript">
    sortable_paginator($("#sorted_table"), "_id", "_id", true);

    var tb = $("#sorted_table").find("tbody"), rwtmpl = `<tr data-spgntr={{_id}}><td>{{_id}}</td><td>{{first}}</td><td>{{last}}</td></tr>`;
    Mustache.parse(rwtmpl);

    $(window).scroll(function () {
        if ($(window).scrollTop() >= $(document).height() - $(window).height() - 10) {
            $("#sorted_table").data("spgntr").pageDown();
        }
    });


    var rws = [];
    _.each(_.range(2, 9999), function(i) {
        var rw = {"_id": i, "first": "F_"+ i, "last": "L_"+i};
        rw.render = function(){ return $(Mustache.render(rwtmpl, this)) };
        rws.push(rw);
    })
    $("#sorted_table").data("spgntr").addObjects(rws);
    _.each(_.range(10000, 10050), function(i) {
        var rw = {"_id": i, "first": "F_"+ i, "last": "L_"+i};
        rw.render = function(){ return $(Mustache.render(rwtmpl, this)) };
        $("#sorted_table").data("spgntr").addObject(rw);
    })

    window.setTimeout(function(){
        _.each([10038, 10052, 10051, 1000, 1], function(i){
            console.log("Adding " + i);
            var rw = {"_id": i, "first": "FUpdated_"+ i, "last": "L_Updated"+i};
            rw.render = function(){ return $(Mustache.render(rwtmpl, this)) };
            $("#sorted_table").data("spgntr").addObject(rw);
        })
    }, 1000*10);
    // To see 1000, $("#sorted_table").data("spgntr").page_end = 8500 then page down...
    // You can use the command down arrow in Chrome for page down.

</script>


</div>


</body>
</html>
